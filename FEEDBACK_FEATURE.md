# Функция "Предложения по улучшению"

## Описание

Добавлена новая функция для сбора предложений по улучшению приложения от пользователей.

## Функциональность

### Фронтенд

1. **Кнопка в хедере**: Добавлена кнопка "Предложения" с иконкой Feedback в правой части хедера
2. **Модальное окно**: При нажатии открывается модальное окно с:
   - Полем ввода текста (до 3000 символов)
   - Счетчиком оставшихся символов
   - Кнопками "Закрыть" и "Отправить"
3. **Автоматическое определение вкладки**: Система автоматически определяет, на какой вкладке находится пользователь при подаче предложения

### Бэкенд

1. **API Endpoint**: `POST /api/feedback`
   - Принимает текст предложения и название вкладки
   - Сохраняет в JSON файл `backend/app/data/feedback.json`
   - Возвращает ID сохраненного предложения

2. **Структура данных**:
   - Текст предложения хранится в `feedback_texts`
   - Метаданные (название вкладки, timestamp) хранятся в `feedback_metadata`
   - Основной ключ - номер предложения (автоинкремент)

### Отправка на почту

1. **Автоматическая отправка**: 
   - Email отправляется **сразу после сохранения** предложения через API endpoint
   - Используется модуль `backend/app/services/email_service.py`
   - Каждое предложение отправляется отдельным письмом

2. **Скрипт для периодической проверки** (опционально): `backend/scripts/send_feedback_email.py`
   - Может использоваться для отправки накопленных предложений (если email не был отправлен сразу)
   - Читает новые предложения из JSON файла
   - Отправляет их на почту `nwisdom@mail.ru` через SendGrid API
   - Помечает отправленные предложения в `sent_feedback.json`

3. **Преимущества SendGrid**:
   - Не требует пароля от почтового ящика
   - Использует только API ключ для аутентификации
   - Бесплатный тариф: 100 писем в день
   - Высокая доставляемость писем

4. **Безопасность**:
   - Адрес почты захардкожен в модуле `email_service.py` и не доступен через API
   - SendGrid API ключ хранится в переменных окружения
   - API ключ можно отозвать в любой момент через веб-интерфейс SendGrid
   - Ошибки отправки email не блокируют сохранение предложения

## Файлы

### Фронтенд
- `frontend/src/components/common/FeedbackDialog.tsx` - компонент модального окна
- `frontend/src/api/feedback.ts` - API клиент для отправки предложений
- `frontend/src/pages/HomePage.tsx` - добавлена кнопка и интеграция

### Бэкенд
- `backend/app/routers/feedback.py` - API endpoint для сохранения предложений и отправки email
- `backend/app/services/email_service.py` - модуль для отправки email через SendGrid API
- `backend/scripts/send_feedback_email.py` - скрипт для периодической проверки (опционально)
- `backend/scripts/README.md` - инструкция по настройке скрипта

## Настройка

### Для отправки на почту

1. **Регистрация в SendGrid**:
   - Зарегистрируйтесь на [SendGrid](https://sendgrid.com/) (бесплатно)
   - Создайте API ключ в Settings → API Keys с правами "Mail Send"

2. **Установите зависимости**:
```bash
pip install sendgrid
```

3. **Настройте Sender Identity в SendGrid** (ОБЯЗАТЕЛЬНО!):
   - Для использования API необходимо настроить **Domain Authentication** (не Single Sender Verification)
   - Войдите в SendGrid Dashboard → Settings → Sender Authentication → Domain Authentication
   - Следуйте инструкциям для аутентификации вашего домена
   - После верификации вы сможете отправлять email с любого адреса на этом домене

4. **Установите переменные окружения в `backend/.env`**:
```bash
SENDGRID_API_KEY=SG.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
SENDGRID_FROM_EMAIL=your-verified-email@yourdomain.com  # ОБЯЗАТЕЛЬНО: верифицированный email адрес
```

**Важно**: `SENDGRID_FROM_EMAIL` должен быть верифицированным адресом через Domain Authentication в SendGrid.

4. **Запустите скрипт вручную или настройте автоматический запуск** (cron/планировщик задач)

Подробнее см. `backend/scripts/README.md`

## Использование

1. Пользователь нажимает кнопку "Предложения" в хедере
2. Вводит текст предложения (до 3000 символов)
3. Нажимает "Отправить"
4. Предложение сохраняется в JSON файл
5. **Сразу после сохранения** отправляется email на `nwisdom@mail.ru` с текстом предложения

**Примечание**: Скрипт `send_feedback_email.py` теперь опционален и может использоваться только для периодической проверки на случай, если email не был отправлен сразу (например, при ошибке SendGrid API).
